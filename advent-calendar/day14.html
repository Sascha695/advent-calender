<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>Adventskalender Tag 14</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>Tag&nbsp;14 – Schiebepuzzle</h1>
  </header>
  <main class="puzzle-container">
    <p>Schiebe die Teile so, dass das Bild wieder korrekt zusammengesetzt ist.</p>
    <div id="sliding-puzzle"></div>
    <div id="puzzleFeedback" style="color:red; margin-top:10px;"></div>
    <div id="letter-container" class="letter-container" style="display:none;">
      <p>Dein Buchstabe:</p>
      <div class="letter" id="letter"></div>
      <p>Merke dir diesen Buchstaben!</p>
    </div>
  </main>
  <footer>
    <a href="index.html">Zurück zum Kalender</a>
  </footer>
  <script>
    const size = 3;
    const puzzleEl = document.getElementById('sliding-puzzle');
    const imageUrl = 'assets/puzzle_image.png';
    // initial order [0..8], 0 = blank
    let board = [];
    function initBoard() {
      board = [];
      for (let i = 0; i < size * size; i++) {
        board.push(i);
      }
      shuffle();
      render();
    }
    function shuffle() {
      // shuffle until solvable
      do {
        for (let i = board.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [board[i], board[j]] = [board[j], board[i]];
        }
      } while (!isSolvable() || isSolved());
    }
    function isSolvable() {
      let inversions = 0;
      for (let i = 0; i < board.length; i++) {
        for (let j = i + 1; j < board.length; j++) {
          if (board[i] && board[j] && board[i] > board[j]) inversions++;
        }
      }
      return inversions % 2 === 0;
    }
    function isSolved() {
      for (let i = 0; i < board.length - 1; i++) {
        if (board[i] !== i + 1) return false;
      }
      return true;
    }
    function render() {
      puzzleEl.innerHTML = '';
      board.forEach((tile, idx) => {
        const div = document.createElement('div');
        const row = Math.floor(tile / size);
        const col = tile % size;
        if (tile === 0) {
          div.classList.add('blank');
        } else {
          div.style.backgroundImage = `url('${imageUrl}')`;
          div.style.backgroundPosition = `-${col * 100}px -${row * 100}px`;
        }
        div.dataset.index = idx;
        div.addEventListener('click', () => moveTile(idx));
        puzzleEl.appendChild(div);
      });
    }
    function moveTile(index) {
      const blankIndex = board.indexOf(0);
      const clickRow = Math.floor(index / size);
      const clickCol = index % size;
      const blankRow = Math.floor(blankIndex / size);
      const blankCol = blankIndex % size;
      const dist = Math.abs(clickRow - blankRow) + Math.abs(clickCol - blankCol);
      if (dist === 1) {
        [board[index], board[blankIndex]] = [board[blankIndex], board[index]];
        render();
        if (isSolved()) {
          showLetter('I');
        }
      }
    }
    function showLetter(letter) {
      const container = document.getElementById('letter-container');
      document.getElementById('letter').textContent = letter;
      container.style.display = 'block';
    }
    initBoard();
  </script>
</body>
</html>